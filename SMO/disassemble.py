# coding: utf-8
import os
apkPath = "/home/apk/android/crawler/"
dirlist = os.listdir(apkPath)
outputPath = "/home/apk/android/apktool_out/"
for i in range(1,len(dirlist)):  # 得到apk 文件夹下的每一个子的类别
    filelist = apkPath + dirlist[i]  # 获取每个类别的路径
    apklist = os.listdir(filelist)  # 获取每个路径下的apk 列表
    category_output = outputPath + dirlist[i]  # 输出的路径列表
    if not os.path.exists(category_output):  # 如果输出的路径不存在那么就创建一个路径
        os.makedirs(category_output)
    for APK in apklist:
        portion = os.path.splitext(APK)  # 将apk文件按照它们的文件名和后缀做一个分割
        APK = os.path.join(apkPath + dirlist[i], APK)
        #newAPK=APK.replace('&','_').replace('(','_').replace(')','_').replace(' ','_')
        #os.rename(APK,newAPK)
        #print ('apk path is %s'%(newAPK))
        apkoutPath = os.path.join(category_output, portion[0])# portion 中 存储的是apk的文件名
        if not os.path.exists(apkoutPath):
            cmd = "apktool d -f {0} -o {1}".format(APK, apkoutPath)  # 反编译出来apk 之后按照文件名在存储
            os.system(cmd)
        else:
            print apkoutPath+" is ignored "
print "all work done! Happy new year~"